name: Daily SFTP Feed Sync

on:
  schedule:
    # Run daily at 6 AM UTC (1 AM Eastern)
    - cron: '0 6 * * *'
  workflow_dispatch:
    # Allow manual trigger from GitHub UI

jobs:
  sync-feed:
    runs-on: ubuntu-latest

    steps:
      - name: Download feed from SFTP
        run: |
          echo "Downloading from SFTP..."
          curl -k -u "${{ secrets.SFTP_USERNAME }}:${{ secrets.SFTP_PASSWORD }}" \
            "sftp://${{ secrets.SFTP_HOST }}/incoming/src/feedonomics/catalog/google_products_ns-company_en_US.csv" \
            -o google_products_ns-company_en_US.csv \
            --fail --show-error

          echo "Downloaded file:"
          ls -lh google_products_ns-company_en_US.csv

      - name: Upload to Render app
        run: |
          echo "Uploading to Render..."
          curl -X POST \
            -F "file=@google_products_ns-company_en_US.csv" \
            "${{ secrets.RENDER_APP_URL }}/api/upload" \
            --fail --show-error

          echo "Upload complete!"
